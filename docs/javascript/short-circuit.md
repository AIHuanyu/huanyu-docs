## 1. 什么是短路运算？
短路运算（Short-Circuit Evaluation）是 JavaScript 中逻辑运算符的核心特性：当左侧操作数能确定整个表达式的结果时，会立即返回结果并停止执行右侧操作数。这种特性不仅能简化代码，还能减少不必要的计算，提升执行效率。

要理解短路运算，首先要明确 JS 中的真假值判定：  
假值（Falsy）：共 6 种，分别是 undefined、null、''（空字符串）、0、NaN、false。  
真值（Truthy）：除假值外的所有值，比如非空字符串、非 0 数字、数组、对象等。
## 2. 三大运算符的短路规则
JS 中支持短路运算的核心运算符包括 &&（逻辑与）、||（逻辑或）和 ??（空值合并），三者规则各有不同，其中 ?? 是 ES2020 新增的精准判断运算符。
### 2.1. 逻辑与（&&）：“找假值，遇假则停”
核心规则：从左到右判断，若左侧为假值，直接返回左侧值（短路）；若左侧为真值，返回右侧值。  
可通俗理解为：“第一个值靠谱吗？不靠谱就用它，靠谱就用下一个” 。  
代码示例：
```js
// 左侧为真值，返回右侧
console.log("hello" && "world"); // 输出 "world"
console.log(123 && 456);         // 输出 456
// 左侧为假值，返回左侧（短路右侧）
console.log("" && "world");      // 输出 ""（空字符串为假值）
console.log(0 && 456);           // 输出 0
console.log(null && "test");     // 输出 null
```
### 2.2. 逻辑或（||）：“找真值，遇真则停”
核心规则：从左到右判断，若左侧为真值，直接返回左侧值（短路）；若左侧为假值，返回右侧值。  
可通俗理解为：“第一个值有用吗？有用就用它，没用就用下一个” 。  
代码示例：
```js
// 左侧为真值，返回左侧（短路右侧）
console.log("hello" || "world"); // 输出 "hello"
console.log(123 || 456);         // 输出 123

// 左侧为假值，返回右侧
console.log("" || "world");      // 输出 "world"
console.log(0 || 456);           // 输出 456
console.log(undefined || "test");// 输出 "test"
```
### 2.3. 空值合并（??）：“仅判 null/undefined，更精准”
核心规则：专门针对 null 和 undefined 的短路判断 —— 左侧为 null 或 undefined 时返回右侧，否则返回左侧。  
这是对 || 的补充，解决了 || 误判 0、'' 等有效假值的问题 。      
代码示例：
```js
// 左侧为null/undefined，返回右侧
console.log(null ?? "默认值");    // 输出 "默认值"
console.log(undefined ?? "默认值");// 输出 "默认值"

// 左侧为0、空字符串等有效假值，返回左侧（与||的关键区别）
console.log(0 ?? "默认值");       // 输出 0
console.log("" ?? "默认值");      // 输出 ""
console.log(NaN ?? "默认值");     // 输出 NaN
```
### 2.4. 运算符优先级
三大运算符的执行顺序为：!（逻辑非） > &&（逻辑与） > ||（逻辑或），?? 优先级与 || 相近，混合使用时建议加括号明确顺序 。
示例解析：
```js
// 执行顺序：!false → true → true && true → true → true || false → true
console.log(!false && true || false); // 输出 true

// 加括号改变顺序：先算 || 再算 &&
console.log(!false && (true || false)); // 结果相同，因括号内为true
```
## 3. 短路运算的实战场景
短路运算在实际开发中应用广泛，能大幅简化条件判断和变量处理逻辑。
### 3.1. 设置默认值
普通默认值：用 || 处理 “无值时用默认” 的场景（如用户昵称为空时显示 “访客”）。
```js
const username = null;
const displayName = username || "访客"; // 输出 "访客" 
```
精准默认值：用 ?? 保留 0、'' 等有效假值（如年龄为 0 时显示 0，而非默认值）。
```js
const age = 0;
const showAge = age ?? 18; // 输出 0（若用||会返回18，不符合预期）
```
### 3.2. 条件执行代码
用 && 替代简单的 if 判断，当左侧条件成立时才执行右侧函数。
```js
// 传统if写法
const isLogin = true;
if (isLogin) {
  console.log("欢迎登录");
}

// 短路运算简化
isLogin && console.log("欢迎登录"); // 输出 "欢迎登录"
```
### 3.3. 多级取值（优先级别获取）
像你之前遇到的 “全局数据→本地存储→默认值” 逻辑，用 || 可一行实现。
```js
// 优先取全局数据，再取本地存储，都没有则为null
const userMbti = app.globalData.userMbti || wx.getStorageSync('userMbti') || null;
```
### 3.4. 条件渲染（前端框架常用）
在 React、Vue 等框架中，用 && 实现 “条件满足才渲染组件”。
```js
// React示例：isShow为true时才渲染<div>内容</div>
{isShow && <div>需要展示的内容</div>}
```
## 4. 避坑注意事项
避免误判有效假值：
不要用 || 处理可能为 0、'' 的场景（如年龄、输入框值），改用 ?? 更精准。例如：
```js
const inputValue = ""; // 用户输入了空字符串（有效输入）
const wrong = inputValue || "请输入内容"; // 错：输出"请输入内容"
const right = inputValue ?? "请输入内容"; // 对：输出""
```
右侧有副作用时需谨慎：
若右侧包含函数调用等副作用（如修改数据、发送请求），短路时会跳过执行，需确认逻辑是否符合预期。
```js
// 当isLogin为false时，logUser()不会执行
isLogin && logUser(); // 仅登录时记录用户行为（合理）
```
混合运算加括号：
多运算符混合时，用括号明确顺序，避免因优先级导致的逻辑错误。
```js
// 预期：(a || b) && c，不加括号会先算b && c
const result = (a || b) && c;
```
## 5. 总结
短路运算的核心是 “按需执行”，三大运算符各有侧重：
- &&：适合 “条件成立才执行 / 取值”（找假停）；
- ||：适合 “取第一个有效真值”（找真停）；
- ??：适合 “仅在无值（null/undefined）时用默认”（精准判空）。  
掌握这一特性，能让你的代码更简洁、高效，同时避免常见的逻辑陷阱。
